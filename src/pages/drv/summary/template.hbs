<main id="content" role="main">
  {{> elements/govuk/phase-banner }}

  <div class="grid-row printhidden">
    <div class="column-two-thirds mobile-column-one-half">
      {{> elements/land-registry/back-link }}
    </div>

    <div class="column-third mobile-column-one-half">
      {{> elements/land-registry/language-switcher }}
    </div>
  </div>

  <h1 class="heading-large spacing-top-single">Summary of title {{title_number}}</h1>

  <p>This title was last changed on <time datetime="{{datetime}}">{{date}}</time></p>

  <div class="grid-row column-flip spacing-top-single">
    <div class="column-one-third tablet-column-one-third">
      <div class="map polygon" id="map"></div>
      <p class="font-xsmall">This map shows the propertyâ€™s rough extent and location, <strong class="bold">not legal boundaries</strong>.</p>
    </div>

    <div class="column-two-thirds tablet-column-two-thirds">

      <dl class="definition-tabular">

        {{#with propertyAddress}}
          <dt>Address</dt>
          <dd class="bold-medium">
            {{> elements/land-registry/address }}
          </dd>
        {{/with}}

        <dt>{{#tenure_freehold}}Owner{{/tenure_freehold}}{{#tenure_leasehold}}Leaseholder{{/tenure_leasehold}}</dt>

        {{#with address}}
          <dd>
            {{> elements/land-registry/address }}
          </dd>
        {{/with}}

        {{#with tenureType}}
          <dt>Tenure type</dt>
          <dd class="bold-small">{{this}}</dd>
        {{/with}}

        {{#lease_term}}
          <dt>Lease length</dt>
          <dd class="bold-small">{{this}}</dd>
        {{/lease_term}}

      </dl>

      <div class="printhidden">

        <div class="govuk-box-highlight">
          <p><strong class="bold">You'll only be able to view this information once.</strong><br>If you want to keep a copy you can print it out</p>

          {{> elements/land-registry/print-button }}
        </div>

        <h2 class="heading-medium collapse-top">What did you think of this service?</h2>
        <p><a rel="external" href="#">Please give us your feedback</a> (takes 30 seconds). <br>This is a trial service and your feedback will help us improve it.</p>

      </div>

    </div>
  </div>

  <div class="grid-row">
    <div class="column-two-thirds text">
      <hr>

      {{#with vat-receipt}}
        {{> elements/land-registry/vat-receipt }}
      {{/with}}

      <div class="panel panel-border-narrow spacing-top-single">
        <p>If you have any problems with your purchase, you can call Land Registry on 0300 006 0411.</p>
        <p>For more contact methods, visit <a href="https://www.gov.uk/government/organisations/land-registry">www.gov.uk/government/organisations/land-registry</a></p>
      </div>

      <hr>

      <div class="printhidden">
        <h2 class="heading-medium">What next</h2>
        <ul>
          <li><a href="#">Search for another title using this service</a></li>
          <li><a href="https://gov.uk">Return to GOV.UK</a></li>
        </ul>
      </div>

    </div>

  </div>

</main>

<script>
  window.onload = function() {

    var indexData = {
      "crs": {
        "properties": {
          "name": "urn:ogc:def:crs:EPSG::27700"
        },
        "type": "name"
      },
      "geometry": {
        "coordinates": [
          [
            [441187.5, 112344.0],
            [441186.0, 112354.0],
            [441193.0, 112356.5],
            [441194.5, 112346.5]
          ]
        ],
        "type": "Polygon"
      },
      "properties": {
        "colour": 25,
        "feature_id": 4019,
        "graphic_type": "Bordered Polygon",
        "render_attributes": {
          "border_colour": 25,
          "border_width": 0,
          "exterior_edge_colour": 1,
          "exterior_edge_thickness": 2,
          "exterior_edge_thickness_units": "Pixels",
          "fill_colour": 25,
          "fill_style": 9,
          "render_level": "0"
        },
        "width": 0
      },
      "type": "Feature"
    };

      // Define coordinate system using PROJ4 standards
    var projection_name = 'EPSG:27700'
    // from: http://epsg.io/27700-5622 - TODO: research which transformation we should use
    var projection_def = '+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=370.396,-108.938,435.682,0,0,0,0 +units=m +no_defs'

    new L.Proj.CRS(projection_name, projection_def,
      {
        resolutions: [2500, 1000, 500, 200, 100, 50, 25, 10, 5, 2.5, 1],
        bounds: L.bounds([1300000,0],[700000,0])
      }
    );

    // set up control and options
    var options = {
      continuousWorld: true,
      worldCopyJump: false,
      minZoom: 15,
      maxZoom: 19,
      // controls
      dragging: false,
      touchZoom: false,
      doubleClickZoom: false,
      scrollWheelZoom: false,
      boxZoom: false,
      keyboard: false,
      tap: false,
      zoomControl: true,
      attributionControl: false
    };

    // set up the map
    var map = new L.Map('map', options);

    // create the tile layer with correct attribution
    var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var osm = new L.TileLayer(osmUrl);
    map.addLayer(osm);

    //Add a scale control to the map
    L.control.scale().addTo(map);

    //Index stlye
    var indexStyle = {
      fillcolor: 'blue',
      fillOpacity: document.getElementById('map').classList.contains('polygon') ? 0.5 : 0,
      opacity: 0
    };

    //Create the index layer
    var indexGeoJson = L.Proj.geoJson(indexData, {
      style: indexStyle
    });

    indexGeoJson.addTo(map);

    //Center map view on geojson polygon
    var bounds = indexGeoJson.getBounds();

    if(!document.getElementById('map').classList.contains('polygon')) {
      L.marker(bounds.getCenter()).addTo(map);
    }

    map.fitBounds(bounds, {maxZoom: 18, animate: false});

  }

</script>
